<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chromatic Wheel â€” D&D Gambling</title>
<style>
  :root{ --bg:#0b0d12; --panel:#141822; --text:#e9edf1; --muted:#97a0ad; --accent:#7bd389; --danger:#ff6b6b; --ring:#1f2633; }
  *{ box-sizing:border-box }
  body{ margin:0; background:radial-gradient(1200px 800px at 70% -10%, #1a2030 0%, #0b0d12 60%); color:var(--text);
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif }
  header{ padding:18px 20px 8px }
  header .title{ font-weight:800; letter-spacing:.3px; font-size:clamp(18px,2.3vw,24px) }
  header .subtitle{ color:var(--muted); font-size:12px }
  main{ display:grid; grid-template-columns:1.2fr 1fr; gap:18px; padding:16px; max-width:1200px; margin:0 auto }
  .card{ background:linear-gradient(185deg,#161c28,#0f1420); border:1px solid #212a3a; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); overflow:hidden }
  .card h2{ margin:0; padding:14px 16px; border-bottom:1px solid #1e2636; font-size:14px; letter-spacing:.3px; color:#bfc8d8; text-transform:uppercase }
  .body{ padding:14px 16px }
  .wheel-wrap{ position:relative; display:grid; place-items:center; padding:12px 12px 2px }
  canvas{ width:100%; max-width:520px; aspect-ratio:1/1; background:radial-gradient(60% 60% at 50% 45%,#1a2233,#0f1420 70%); border-radius:50%; border:2px solid var(--ring) }
  /* TOP POINTER: white, pointing DOWN */
.pointer-top{
  position:absolute; top:4px; left:50%; transform:translateX(-50%);
  width:0; height:0;
  border-left:16px solid transparent;
  border-right:16px solid transparent;
  border-top:26px solid #ffffff; /* points DOWN */
  filter:drop-shadow(0 2px 2px rgba(0,0,0,.6));
}
  .small{ font-size:12px; color:var(--muted); margin-top:8px }
  .controls{ display:grid; gap:10px }
  .grid{ display:grid; grid-template-columns:1fr auto auto; gap:6px 10px; align-items:center }
  .pill{ padding:6px 10px; border-radius:999px; font-weight:700; letter-spacing:.2px; font-size:13px; display:inline-flex; align-items:center; gap:8px;
         border:1px solid #293246; background:#121826 }
  .pill small{ font-weight:600; color:var(--muted) }
  input[type="number"]{ width:100px; padding:8px 10px; border-radius:10px; border:1px solid #2a354a; background:#0f1420; color:#fff }
  .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px }
  button{ cursor:pointer; border:1px solid #2a354a; color:#e9edf1; background:#0f1420; padding:10px 14px; border-radius:12px; font-weight:700;
          transition:.15s transform ease,.15s background ease,.15s border ease,.15s opacity ease }
  button.primary{ background:linear-gradient(180deg,#19b57b,#14a46e); border-color:#1c8a67; box-shadow:0 4px 16px rgba(22,178,123,.35) }
  button:disabled{ opacity:.55; cursor:not-allowed }
  .meta{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  .stat{ background:#101626; border:1px solid #1d2332; border-radius:12px; padding:10px 12px }
  .stat .k{ font-size:12px; color:var(--muted) }
  .stat .v{ font-weight:800; letter-spacing:.3px; margin-top:2px }
  .result{ margin-top:10px; padding:10px 12px; border-radius:12px; border:1px dashed #2a354a; background:#0e1523 }
  .ok{ color:#98f5c2 } .bad{ color:#ff6b6b }
  .paytable{ font-size:13px; border-collapse:collapse; width:100% }
  .paytable th,.paytable td{ padding:8px 8px; border-bottom:1px solid #1f2636 }
  .chip{ display:inline-block; min-width:12px; min-height:12px; border-radius:50%; margin-right:8px; border:2px solid #0006; box-shadow:inset 0 0 0 2px #fff4 }
  .footer{ padding:12px 16px; border-top:1px solid #1e2636; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between }
  code{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:12px; color:#c7d2e2 }
  @media (max-width:980px){ main{ grid-template-columns:1fr } }
</style>
</head>
<body>
<header>
  <div class="logo-wrap">
    <img src="assets/logo.png" alt="Chromatic Wheel" class="logo" height="70">
  </div>
</header>

<main>
  <section class="card">
    <h2>Wheel</h2>
    <div class="body wheel-wrap">
      <div class="pointer-top" aria-hidden="true"></div>
	  
      <canvas id="wheel" width="1000" height="1000"></canvas>
      <div class="small" id="rolledInfo">â€”</div>
    </div>
     </section>

  <section class="card">
    <h2>Bets & Controls</h2>
    <div class="body controls">
      <div id="bets" class="grid"></div>
      <div class="btnrow">
        <button id="spinBtn" class="primary">ðŸŽ² Spin</button>
        <button id="clearBtn">Clear Bets</button>
        <button id="cashBtn">ðŸ’° Cash Out</button>
      </div>
      <div class="meta">
        <div class="stat"><div class="k">Spent (total)</div><div class="v" id="spent">0</div></div>
        <div class="stat"><div class="k">Won (total)</div><div class="v" id="won">0</div></div>
        <div class="stat"><div class="k">Net</div><div class="v" id="net">0</div></div>
        <div class="stat"><div class="k">Last Payout</div><div class="v" id="lastPayout">â€”</div></div>
      </div>
      <div class="result" id="result">Place bets and press <b>Spin</b>.</div>
      <details>
        <summary class="small">Show Payout Table</summary>
        <table class="paytable" id="paytable"></table>
      </details>
    </div>
  </section>
</main>

<script>
/* ========= CONFIG (edit here) ========= */
const CONFIG = {
  groups: [
    { key:'Violet', color:'#7b1fa2', payout:100000, ranges:[[7,8],[73,74]] },
    { key:'Indigo', color:'#3949ab', payout:120,    ranges:[[9,20],[63,72]] },
    { key:'Blue',   color:'#1e88e5', payout:15,     ranges:[[21,23],[58,62]] },
    { key:'Green',  color:'#43a047', payout:6,      ranges:[[24,28],[53,57]] },
    { key:'Yellow', color:'#fdd835', payout:3,      ranges:[[29,33],[49,52]] },
    { key:'Orange', color:'#fb8c00', payout:4,      ranges:[[34,36],[45,48]] },
    { key:'Red',    color:'#e53935', payout:3,      ranges:[[37,44]] },
  ],
  wheelWeights: { Violet:1, Indigo:3, Blue:5, Green:8, Yellow:10, Orange:10, Red:14 }, // visual only
  sounds: {
    spin:     'assets/wheelspin.wav',
    winMinor: 'assets/minorwin.wav',
    winMajor: 'assets/majorwin.wav',
    lose:     'assets/lose.wav'
  },
  currency:'gp',
  spinMsMin:2370, spinMsMax:2430 // 2.37â€“2.43s
};

/* ========= Utilities ========= */
function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }
function fmt(n){ return Number(n).toLocaleString(undefined,{maximumFractionDigits:0}); }
function inRanges(n, ranges){ return ranges.some(([a,b]) => n>=a && n<=b); }

/* Dice: 2d20 + 1d12 + 3d6 + 1d4 */
function rollAllDice(){
  const r=s=>1+Math.floor(Math.random()*s);
  const d20=[r(20),r(20)], d12=r(12), d6=[r(6),r(6),r(6)], d4=r(4);
  return { total: d20[0]+d20[1]+d12+d6[0]+d6[1]+d6[2]+d4, parts:{d20,d12,d6,d4} };
}
function groupFor(total){ return CONFIG.groups.find(g => inRanges(total,g.ranges)) || null; }

/* ========= Wheel geometry/render ========= */
const canvas=document.getElementById('wheel'), ctx=canvas.getContext('2d');
const W=canvas.width, H=canvas.height, CX=W/2, CY=H/2, R=W*0.47;

const POINTER_ANGLE = -Math.PI/2; // top
let wheelRotation = 0;            // radians

function buildSlices(){
  const entries = CONFIG.groups.map(g => ({ g, w:(CONFIG.wheelWeights[g.key]||1) }));
  const sumW = entries.reduce((a,b)=>a+b.w,0);
  let start = 0; // build from +X axis
  return entries.map(({g,w})=>{
    const sweep = (w/sumW)*Math.PI*2;
    const s = start, e = start+sweep; start = e;
    return { key:g.key, color:g.color, start:s, end:e, mid:s+sweep/2 };
  });
}
let SLICES = buildSlices();

function drawWheel(){
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(CX,CY);
  ctx.rotate(wheelRotation);
  ctx.translate(-CX,-CY);

  for(const s of SLICES){
    ctx.beginPath();
    ctx.moveTo(CX,CY);
    ctx.arc(CX,CY,R,s.start,s.end);
    ctx.closePath();
    ctx.fillStyle=s.color; ctx.fill();
    ctx.strokeStyle='#0b0f19'; ctx.lineWidth=3; ctx.stroke();
  }

  // hub
  ctx.beginPath(); ctx.arc(CX,CY,R*0.12,0,Math.PI*2);
  ctx.fillStyle='#0d1320'; ctx.fill();
  ctx.lineWidth=4; ctx.strokeStyle='#1f2839'; ctx.stroke();

  ctx.restore();
}

/* ========= Sounds (simple HTMLAudio) ========= */
const SND = {
  spin:  new Audio(CONFIG.sounds.spin),
  minor: new Audio(CONFIG.sounds.winMinor),
  major: new Audio(CONFIG.sounds.winMajor),
  lose:  new Audio(CONFIG.sounds.lose),
};
Object.values(SND).forEach(a => { a.preload='auto'; a.load(); a.volume=0.9; });
function playSfx(a){ try{ a.currentTime=0; a.play().catch(()=>{}); }catch{} }

/* ========= UI: bets, stats, table ========= */
const betsEl=document.getElementById('bets'), paytableEl=document.getElementById('paytable');
const spentEl=document.getElementById('spent'), wonEl=document.getElementById('won'), netEl=document.getElementById('net');
const lastPayoutEl=document.getElementById('lastPayout'), resultEl=document.getElementById('result'), rolledInfoEl=document.getElementById('rolledInfo');

function makeDot(c){ const s=document.createElement('span'); s.className='chip'; s.style.background=c; return s; }
const betInputs=new Map();
function renderBets(){
  betsEl.innerHTML='';
  const h1=document.createElement('div'); h1.className='pill'; h1.innerHTML='<small>Color</small>';
  const h2=document.createElement('div'); h2.className='pill'; h2.innerHTML='<small>Numbers</small>';
  const h3=document.createElement('div'); h3.className='pill'; h3.innerHTML='<small>Bet ('+CONFIG.currency+')</small>';
  betsEl.append(h1,h2,h3);
  for(const g of CONFIG.groups){
    const n=document.createElement('div'); n.className='pill'; n.append(makeDot(g.color), document.createTextNode(g.key));
    const r=document.createElement('div'); r.className='pill';
    r.innerHTML = `<small>${g.ranges.map(([a,b])=>a===b?a:(a+'â€“'+b)).join(', ')}</small> Ã—${fmt(g.payout)}`;
    const i=document.createElement('input'); i.type='number'; i.min='0'; i.step='1'; i.placeholder='0';
    betInputs.set(g.key,i);
    betsEl.append(n,r,i);
  }
}
function renderTable(){
  if(!paytableEl) return;
  const rows=[`<tr><th style="text-align:left">Color</th><th style="text-align:left">Numbers Covered</th><th style="text-align:right">Payout</th></tr>`];
  for(const g of CONFIG.groups){
    rows.push(`<tr><td><span class="chip" style="background:${g.color}"></span>${g.key}</td>
                 <td>${g.ranges.map(([a,b])=>a===b?a:(a+'â€“'+b)).join(', ')}</td>
                 <td style="text-align:right">Ã—${fmt(g.payout)}</td></tr>`);
  }
  paytableEl.innerHTML = rows.join('');
}
renderBets(); renderTable();

let SPENT=0, WON=0;
function updateStats(){
  spentEl.textContent = `${fmt(SPENT)} ${CONFIG.currency}`;
  wonEl.textContent   = `${fmt(WON)} ${CONFIG.currency}`;
  const net=WON-SPENT;
  netEl.textContent   = `${net>=0?'+':''}${fmt(net)} ${CONFIG.currency}`;
  netEl.parentElement.querySelector('.v').style.color = net>=0 ? 'var(--accent)' : 'var(--danger)';
}

/* ========= Spin (6â€“8 full turns) ========= */
let spinning=false;
function totalBet(){ let t=0; for(const [,i] of betInputs){ const v=Math.max(0,Math.floor(Number(i.value||0))); if(Number.isFinite(v)) t+=v; } return t; }
function betMap(){ const m=new Map(); for(const [k,i] of betInputs){ const v=Math.max(0,Math.floor(Number(i.value||0))); if(v>0) m.set(k,v); } return m; }
function findSliceByKey(k){ return SLICES.find(s=>s.key===k); }

function spinToSliceKey(key, done){
  const s=findSliceByKey(key); if(!s){ done?.(); return; }

  const FULL = Math.PI*2;
  const baseAlign = POINTER_ANGLE - s.mid;
  const extraTurns = 6 + Math.floor(Math.random()*3);  // 6â€“8 spins every time
  const finalRotation = baseAlign + extraTurns*FULL;

  const start = wheelRotation;
  const end   = finalRotation;

  const dur = CONFIG.spinMsMin + Math.random()*(CONFIG.spinMsMax - CONFIG.spinMsMin);

  playSfx(SND.spin);

  const t0=performance.now();
  const easeOutCubic = p => 1 - Math.pow(1-p,3);

  function frame(t){
    const p = clamp((t - t0)/dur, 0, 1);
    const e = easeOutCubic(p);
    wheelRotation = start + (end - start)*e;
    drawWheel();
    if(p<1) requestAnimationFrame(frame);
    else{
      wheelRotation = ((end % FULL) + FULL) % FULL;
      drawWheel();
      done?.();
    }
  }
  requestAnimationFrame(frame);
}

/* ========= Wire up ========= */
const spinBtn=document.getElementById('spinBtn');
const clearBtn=document.getElementById('clearBtn');
const cashBtn=document.getElementById('cashBtn');

function setDisabled(v){ spinBtn.disabled=v; clearBtn.disabled=v; cashBtn.disabled=v; }

spinBtn.addEventListener('click', () => {
  if(spinning) return;

  const betSum = totalBet();
  if(betSum<=0){
    resultEl.textContent = 'Place at least one bet before spinning.';
    resultEl.classList.remove('ok','bad');
    return;
  }

  const roll = rollAllDice();
  const winner = groupFor(roll.total);
  const bets = betMap();

  SPENT += betSum; updateStats();
  setDisabled(true); spinning=true;

  const {d20,d12,d6,d4} = roll.parts;
  rolledInfoEl.textContent = `Rolled: ${roll.total} â€” 2d20 [${d20[0]}, ${d20[1]}] + d12 [${d12}] + 3d6 [${d6.join(', ')}] + d4 [${d4}]`;

  spinToSliceKey(winner.key, () => {
    const wager = bets.get(winner.key)||0;
    const payout = wager * winner.payout;

    if(payout>0){
      WON += payout; updateStats();
      lastPayoutEl.textContent = `Ã—${fmt(winner.payout)} (${winner.key}) â†’ ${fmt(payout)} ${CONFIG.currency}`;
      resultEl.innerHTML = `WIN! Bet <b>${fmt(wager)} ${CONFIG.currency}</b> on <b>${winner.key}</b>, rolled <b>${roll.total}</b>. Payout: <b>${fmt(payout)} ${CONFIG.currency}</b>`;
      resultEl.classList.add('ok'); resultEl.classList.remove('bad');
      playSfx(winner.payout>5 ? SND.major : SND.minor);
    }else{
      lastPayoutEl.textContent = 'â€”';
      resultEl.innerHTML = `LOSS. Landed on <b>${winner.key}</b> (rolled <b>${roll.total}</b>).`;
      resultEl.classList.add('bad'); resultEl.classList.remove('ok');
      playSfx(SND.lose);
    }
    spinning=false; setDisabled(false);
  });
});

clearBtn.addEventListener('click', () => {
  for(const i of betInputs.values()) i.value='';
  resultEl.textContent='Bets cleared.'; resultEl.classList.remove('ok','bad');
});

cashBtn.addEventListener('click', () => {
  const net=WON-SPENT, sign=net>=0?'+':'âˆ’';
  alert(`Cash Out:

Spent:  ${fmt(SPENT)} ${CONFIG.currency}
Won:    ${fmt(WON)} ${CONFIG.currency}
-------------------------
Net:    ${sign}${fmt(Math.abs(net))} ${CONFIG.currency}

Add/Subtract this on your character sheet.`);
});

/* init */
drawWheel(); updateStats();
</script>
</body>
</html>
